<html>
<head>
    <title> OpenTok Getting Started </title>
    <link href="css/app.css" rel="stylesheet" type="text/css">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>
    <script src="./js/js.cookie.js"></script>

</head>

<body>
  <table>
    <tr>
      <td><label for="username">username</label></td>
    </tr>
    <tr>
      <td><input id="username"></input></td>
    </tr>
  </table>

</body>

<script>

// $.get( "ajax/test.html", function( data ) {
//   $( ".result" ).html( data );
// });
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyD84RAySxzyaJ8N2wN8RdY1LxZLXfY6O2Q",
    authDomain: "globetalk-d9e6b.firebaseapp.com",
    databaseURL: "https://globetalk-d9e6b.firebaseio.com",
    projectId: "globetalk-d9e6b",
    storageBucket: "globetalk-d9e6b.appspot.com",
    messagingSenderId: "42178570730"
  };
  firebase.initializeApp(config);

	var db = firebase.database();
  var usersRef = db.ref('users');

  $("#username").keyup(function(event) {
    if (event.keyCode === 13) {
      username = $("#username").val();

      // console.log(username);

        // ask for token
        usersRef.orderByChild('username').equalTo(username).on("value", function(snapshot) {

          var vals = snapshot.val();
          //console.log(vals);
          for( item in vals){
            teacher = vals[item]["teacher"]
            token = vals[item]["last_token"]
            console.log(token);

            Cookies.set('globetalk_token', token, { expires: 7 });
            Cookies.set('globetalk_teacher', teacher, {expires: 7});
            Cookies.set('globetalk_username', username, {expires: 7});
            document.location.href = "/vid-chat-web/home";
          }

          // snapshot.forEach(function(data) {
          //   console.log(data.key);
          // });
        });
        // set user active
    }
  });

</script>

</html>
